#!/usr/bin/env bash

# Update and install UFW
sudo apt update
sudo apt install -y ufw

# Enable UFW
sudo ufw enable

# Allow SSH, HTTP, and HTTPS
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# Deny all other incoming traffic
sudo ufw default deny incoming

# Reload UFW to apply the changes
sudo ufw reload

# Add an IPtables rule for port forwarding (redirect 8080 to 80)
sudo iptables -t nat -A PREROUTING -p tcp --dport 8080 -j REDIRECT --to-port 80

# Save the IPtables rule to persist across reboots
sudo iptables-save > /etc/iptables/rules.v4

# Display the UFW status to verify the rules
sudo ufw status
